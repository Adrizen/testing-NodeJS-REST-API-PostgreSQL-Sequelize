CREATE TABLE IF NOT EXISTS projects(
    id  INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name    text NOT NULL CHECK (name <> ''),
    priority    integer NOT NULL,
    description text,
    deliverydate    date NOT NULL
);
CREATE TABLE IF NOT EXISTS tasks(
    id  INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name text NOT NULL CHECK (name <> ''),
    done    BOOLEAN,
    projectid   INTEGER REFERENCES projects(id)
);

CREATE TABLE IF NOT EXISTS users(
    id  INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    name text NOT NULL CHECK (name <> ''),
    password text NOT NULL CHECK (password <> ''),
    email text UNIQUE CHECK (email <> ''),
    CONSTRAINT users_email_check UNIQUE (email)
);

CREATE TABLE IF NOT EXISTS posts(
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    title text NOT NULL CHECK (title <> ''),
    body text NOT NULL CHECK (body <> ''),
    userid INTEGER REFERENCES users(id)
);

CREATE TABLE IF NOT EXISTS roles(
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    role text NOT NULL CHECK (role <> '')
);

CREATE TABLE IF NOT EXISTS user_role(
    id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    user_id INTEGER REFERENCES users(id),
    role_id INTEGER REFERENCES roles(id)
);

-- INSERT PROJECTS DATA.
-- User needs to register with the API to get his password encrypted.

INSERT INTO projects(id,name, priority, description, deliverydate) VALUES 
    (1,'Make a web app', 1, 'Using JavaScript', '2022-04-09'),
    (2,'Make an app', 1, 'Using Dart', '2022-04-10'),
    (3,'Make a desktop app', 2, 'Using C++', '2023-04-09');

INSERT INTO tasks(id,name, done, projectid) VALUES
    (1,'Download VueJs', false, 1),
    (2,'Create UI Web', false, 1),
    (3,'Download Flutter', false, 2),
    (4,'Design UI', false, 2);

INSERT INTO posts(id,title, body, userid, "createdAt", "updatedAt") VALUES
    (1,'Eco', 'This is a water bottle', 1, Date(NOW()), Date(NOW()) ),
    (2,'Elden Ring', 'A souls like game lol', 1, Date(NOW()), Date(NOW())),
    (3,'Sharknet', 'Destroyed mouse pad', 2, Date(NOW()), Date(NOW())),
    (4,'Falsalarma', 'An old rap music group', 3, Date(NOW()), Date(NOW())),
    (5,'Tuki', 'Redragon keyboard for example', 3, Date(NOW()), Date(NOW()));

INSERT INTO roles(id,role,"createdAt","updatedAt") VALUES
    (1,'admin', Date(NOW()), Date(NOW())),
    (2,'user', Date(NOW()), Date(NOW()));

INSERT INTO user_role("createdAt","updatedAt", user_id, "RoleId") VALUES
    (Date(NOW()), Date(NOW()), 2,1),
    (Date(NOW()), Date(NOW()), 2,2),
    (Date(NOW()), Date(NOW()), 1,2)